# サイトテキスト起こせるくん 要件定義書

## 1. 背景・目的
- Webサイトの本文テキストを迅速に抽出し、広告・制作・ライティング業務での調査効率を向上させる。
- 指定URLのページ全体を自動スクリーンショット化し、Gemini APIで文字起こしする仕組みを整備することを目的とする。

## 2. 対象範囲
- 本アプリはデスクトップ環境（macOS / Windows）で動作する。
- 単一または複数URLのバッチ処理を想定し、1回あたり最大10ページ程度までを目安とする。
- Gemini APIキーを保有し、利用規約を遵守できるユーザーを対象とする。

## 3. 利用想定者
- リスティング広告やLP制作に携わるマーケター、コピーライター、制作担当者。
- 競合サイトの構成やコピーを調査したい担当者。

## 4. 全体要件
1. URL入力またはURLリストファイルのインポート機能を提供する。
2. ヘッドレスブラウザでページをフルレンダリングし、縦方向2000px単位で順次スクリーンショットを取得する。
3. 取得した画像をGemini APIに送信し、順序を保持したテキストを抽出する。
4. 抽出テキストを整形し、MarkdownまたはJSONとしてローカル保存する。
5. 処理進行状況・結果・エラー情報をUIまたはログで表示する。

## 5. 機能要件
- **URL管理**: 単一URL入力、CSV/TSV/JSONからの複数URL読込、加工済みリストの保存。
- **スクリーンショット取得**: ページ高さ計測、2000px刻みのスクロール撮影、画像一時保存、失敗時の再試行。
- **テキスト化**: Gemini APIへの画像送信、連番制御、APIレスポンスの整形、結合テキスト生成。
- **出力管理**: ページごとのフォルダー作成、画像・テキストの命名規則付与、既存ファイルへの追記/上書き設定。
- **UI表示**: 進捗バー、現在処理中URL、成功/失敗件数、詳細ログビューア。
- **設定**: APIキー入力、ブラウザ待機時間、画像圧縮品質、同時実行数、出力フォーマット。

## 6. 非機能要件
- **性能**: 1URLあたり処理完了まで概ね5分以内を目標（ページ構造に依存）。
- **信頼性**: 通信エラー時は最大3回の指数バックオフ再試行。失敗時はユーザーに明示しスキップ継続。
- **可観測性**: ローカルログ（JSON Linesまたはテキスト）を出力し、処理時間やエラー内容を記録。
- **保守性**: フロントエンドとバックエンドをモジュール分離し、今後の拡張（例: 他API対応）を容易にする。
- **セキュリティ**: APIキーは環境変数または暗号化ストレージで保存し、UIにはマスク表示。ログへ平文出力しない。

## 7. システム構成
- **フロントエンド**: ElectronやPySide等のGUIフレームワークを想定。入力フォーム、設定画面、ログビューを提供。
- **バックエンド処理**:
  - ブラウザ制御モジュール（Playwright/Puppeteer等）。
  - 画像処理モジュール（2000pxスライス、圧縮）。
  - Geminiクライアント（REST呼び出し、レート制御）。
  - テキスト整形モジュール（順序維持、フォーマット生成）。
- **データストレージ**: プロジェクト配下に `outputs/<日付>/<URL識別子>/` を作成し、画像・テキスト・ログを保存。

## 8. 処理フロー
1. ユーザーがURLと設定を入力し、処理を開始。
2. バックエンドがブラウザを起動し対象ページをレンダリング。
3. ページ高さを計測し、2000pxごとにスクロールしながらスクリーンショットを取得。
4. 取得画像をローカル保存後、Gemini APIへ順次送信しテキストを取得。
5. 取得テキストを結合・整形し、指定フォーマットで保存。
6. UIで成功/失敗を更新し、完了後ユーザーへ通知。

## 9. エラーハンドリング
- ページロードタイムアウト: 再試行後に失敗として記録、ユーザーへ通知。
- Gemini APIエラー: ステータスコードを解析し再試行、API制限超過時は処理停止を提案。
- ファイル保存エラー: パス権限や重複を通知し、ユーザーに再設定を促す。
- APIキー未設定: 処理開始時にバリデーションし、エラー表示。

## 10. 環境・運用要件
- 必須: Gemini APIキー、最新ブラウザドライバー、Python 3.10+。
- 推奨: Playwright/Puppeteerの自動セットアップスクリプト、仮想環境による依存管理。
- 運用: Gemini課金監視、API利用制限に応じたスロットリング設定。

## 11. ドキュメント要件
- セットアップ手順（依存ライブラリ、APIキー設定方法）。
- 利用手順（URL登録〜結果確認）。
- トラブルシュート（代表的なエラーと対処法）。
- サンプル出力例（スクリーンショット、テキストファイル）。

## 12. 今後のタスク
1. 技術スタックの確定とPoC（ブラウザ自動化・Gemini連携）。
2. モジュール設計詳細とデータモデル定義。
3. プロトタイプ実装・テスト・UI整備。
4. リリースドキュメント・ユーザーガイド整備。

