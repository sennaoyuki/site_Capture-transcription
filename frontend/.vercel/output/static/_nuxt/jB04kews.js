import{d as F,n as I,r,k as O,x as a,y as n,z as e,J as E,K as h,L as $,M as D,N as o,O as S,P as N,Q as B,R as T,A as p,S as A,T as H,U as J,V as K,W as Q}from"#entry";const W={class:"min-h-screen bg-gray-50"},q={class:"max-w-7xl mx-auto px-4 py-8"},G={class:"card mb-6"},X={class:"mb-4"},Y={class:"flex gap-6"},Z={class:"flex items-center cursor-pointer"},tt={class:"flex items-center cursor-pointer"},et={key:0,class:"mb-4"},st={key:1,class:"mb-4"},lt={key:0},ot={key:1},nt={class:"text-gray-700 font-semibold mb-2 text-sm"},rt=["disabled"],at={key:0},it={key:1},dt={key:0,class:"card mb-6"},ut={class:"w-full bg-gray-200 rounded-full h-2 mb-3"},ct={class:"text-sm text-gray-600"},pt={key:1,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},vt={class:"card"},ft={class:"transition-all duration-300"},mt=["src"],bt={class:"space-y-6"},xt={class:"card"},yt={class:"space-y-4 max-h-[600px] overflow-y-auto pr-2"},gt={class:"flex items-center justify-between mb-2"},wt={class:"font-semibold text-gray-800"},kt=["onClick"],ht={class:"text-xs text-gray-500 mb-2"},$t={class:"whitespace-pre-wrap text-sm text-gray-700"},_t={class:"mt-4"},Ct={class:"space-y-2"},St={key:0,class:"mt-4 p-3 bg-gray-50 rounded text-xs text-gray-600"},Tt={class:"break-all"},jt={class:"relative max-w-6xl max-h-full overflow-auto"},Mt=["src"],Ut=F({__name:"index",setup(Dt){const m=I().public.apiBase,i=r("url"),b=r(""),u=r(null),x=r(!1),d=r(!1),v=r(null),j=r(null),_=r(0),c=r("待機中..."),f=r([]),y=r(null),g=r(""),w=r(!1),k=r(!0),L=O(()=>i.value==="url"?b.value.trim()!=="":u.value!==null),P=s=>{const t=s.target;t.files&&t.files[0]&&(u.value=t.files[0])},U=s=>{x.value=!1,s.dataTransfer?.files&&s.dataTransfer.files[0]&&(u.value=s.dataTransfer.files[0])},R=async()=>{d.value=!0,_.value=0,c.value="処理を開始しています...",f.value=[],y.value=null,g.value="";try{let s;if(i.value==="url")s=await fetch(`${m}/api/transcribe/url`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:b.value})});else{const l=new FormData;l.append("file",u.value),s=await fetch(`${m}/api/transcribe/upload`,{method:"POST",body:l})}if(!s.ok)throw new Error("処理の開始に失敗しました");const t=await s.json();v.value=t.job_id,M()}catch(s){console.error("Error:",s),c.value="エラーが発生しました",d.value=!1,alert("エラーが発生しました。もう一度お試しください。")}},M=async()=>{if(v.value)try{const s=await fetch(`${m}/api/status/${v.value}`);if(!s.ok)throw new Error("Status check failed");const t=await s.json();j.value=t,_.value=t.progress||0,c.value=t.message||"処理中...",t.status==="completed"?(d.value=!1,y.value=t.result,f.value=t.result.segments||[],g.value=`${m}/api/download/${v.value}/screenshot`,c.value="完了！"):t.status==="error"?(d.value=!1,c.value=`エラー: ${t.error}`,alert(`エラーが発生しました: ${t.error}`)):setTimeout(M,1e3)}catch(s){console.error("Polling error:",s),d.value=!1,c.value="ステータス確認エラー"}},V=s=>{if(!s.text){alert("コピーする内容がありません");return}navigator.clipboard.writeText(s.text),alert(`📋 スライス #${s.index} をコピーしました！`)},z=()=>{if(f.value.length===0){alert("コピーする内容がありません");return}const s=f.value.map(t=>`# スライス ${t.index}

${t.text}`).join(`

---

`);navigator.clipboard.writeText(s),alert("📋 全スライスをクリップボードにコピーしました！")},C=s=>{if(!v.value)return;const t=`${m}/api/download/${v.value}/${s}`;window.open(t,"_blank")};return(s,t)=>(n(),a("div",W,[e("div",q,[t[27]||(t[27]=e("header",{class:"mb-8"},[e("h1",{class:"text-4xl font-bold text-gray-900 mb-2"}," ✨ LP文字起こしツール "),e("p",{class:"text-lg text-gray-600"}," URLやローカルHTMLから簡単に文字起こし ")],-1)),e("div",G,[t[19]||(t[19]=e("h2",{class:"text-xl font-bold mb-4"},"📝 入力設定",-1)),e("div",X,[e("div",Y,[e("label",Z,[$(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=l=>S(i)?i.value=l:null),value:"url",class:"mr-2"},null,512),[[D,o(i)]]),t[16]||(t[16]=e("span",{class:"text-gray-700"},"🌐 URL",-1))]),e("label",tt,[$(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=l=>S(i)?i.value=l:null),value:"upload",class:"mr-2"},null,512),[[D,o(i)]]),t[17]||(t[17]=e("span",{class:"text-gray-700"},"📁 ローカルHTML",-1))])])]),o(i)==="url"?(n(),a("div",et,[$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>S(b)?b.value=l:null),type:"url",placeholder:"https://example.com",class:"input-field"},null,512),[[N,o(b)]])])):(n(),a("div",st,[e("div",{onDrop:T(U,["prevent"]),onDragover:t[5]||(t[5]=T(()=>{},["prevent"])),onDragenter:t[6]||(t[6]=l=>x.value=!0),onDragleave:t[7]||(t[7]=l=>x.value=!1),class:B(["border-2 border-dashed rounded-lg p-6 text-center transition-colors",o(x)?"border-primary bg-primary-light":"border-gray-300 bg-gray-50"])},[e("input",{ref:"fileInput",type:"file",accept:".html,.htm",onChange:P,class:"hidden"},null,544),o(u)?(n(),a("div",ot,[e("p",nt,p(o(u).name),1),e("button",{onClick:t[4]||(t[4]=l=>u.value=null),class:"btn-secondary text-sm"}," ✕ 削除 ")])):(n(),a("div",lt,[t[18]||(t[18]=e("p",{class:"text-gray-600 mb-2 text-sm"}," ファイルをドラッグ&ドロップ または ",-1)),e("button",{onClick:t[3]||(t[3]=l=>s.$refs.fileInput.click()),class:"btn-secondary text-sm"}," 📂 ファイルを選択 ")]))],34)])),e("button",{onClick:R,disabled:o(d)||!o(L),class:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed"},[o(d)?(n(),a("span",it,"処理中...")):(n(),a("span",at,"🚀 文字起こし実行"))],8,rt)]),o(d)||o(j)?(n(),a("div",dt,[t[20]||(t[20]=e("h2",{class:"text-xl font-bold mb-4"},"⏳ 進行状況",-1)),e("div",ut,[e("div",{class:"bg-primary h-2 rounded-full transition-all duration-300",style:A({width:`${o(_)}%`})},null,4)]),e("p",ct,p(o(c)),1)])):h("",!0),o(f).length>0?(n(),a("div",pt,[e("div",vt,[e("button",{onClick:t[8]||(t[8]=l=>k.value=!o(k)),class:"w-full flex items-center justify-between text-left mb-4"},[t[22]||(t[22]=e("h2",{class:"text-xl font-bold"},"📸 スクリーンショットプレビュー",-1)),(n(),a("svg",{class:B(["w-6 h-6 transition-transform",o(k)?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[21]||(t[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),$(e("div",ft,[e("div",{onClick:t[9]||(t[9]=l=>w.value=!0),class:"cursor-pointer hover:opacity-90 transition-opacity"},[e("img",{src:o(g),alt:"Screenshot",class:"w-full rounded-lg border border-gray-200 shadow-sm"},null,8,mt),t[23]||(t[23]=e("p",{class:"text-xs text-center text-gray-500 mt-2"}," クリックで拡大表示 ",-1))])],512),[[H,o(k)]])]),e("div",bt,[e("div",xt,[t[26]||(t[26]=e("h2",{class:"text-xl font-bold mb-4"},"📄 スライスごとの文字起こし結果",-1)),e("div",yt,[(n(!0),a(J,null,K(o(f),l=>(n(),a("div",{key:l.index,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},[e("div",gt,[e("h3",wt," スライス #"+p(l.index),1),e("button",{onClick:Lt=>V(l),class:"text-xs text-primary hover:text-primary-hover"}," 📋 コピー ",8,kt)]),e("div",ht," 位置: "+p(l.top)+"px 〜 "+p(l.bottom)+"px ",1),e("pre",$t,p(l.text||"（テキストなし）"),1)]))),128))]),e("button",{onClick:z,class:"btn-primary w-full mt-4"}," 📋 全スライスをコピー "),e("div",_t,[t[24]||(t[24]=e("h3",{class:"text-sm font-semibold text-gray-700 mb-2"}," 💾 ダウンロード形式を選択 ",-1)),e("div",Ct,[e("button",{onClick:t[10]||(t[10]=l=>C("markdown")),class:"btn-secondary w-full justify-center"}," 📄 Markdown "),e("button",{onClick:t[11]||(t[11]=l=>C("text")),class:"btn-secondary w-full justify-center"}," 📄 テキスト "),e("button",{onClick:t[12]||(t[12]=l=>C("screenshot")),class:"btn-secondary w-full justify-center"}," 📸 スクリーンショット ")])]),o(y)?(n(),a("div",St,[t[25]||(t[25]=e("p",{class:"font-semibold mb-1"},"出力先:",-1)),e("p",Tt,p(o(y).run_dir),1)])):h("",!0)])])])):h("",!0)]),(n(),E(Q,{to:"body"},[o(w)?(n(),a("div",{key:0,onClick:t[15]||(t[15]=l=>w.value=!1),class:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4"},[e("div",jt,[e("button",{onClick:t[13]||(t[13]=l=>w.value=!1),class:"absolute top-4 right-4 bg-white rounded-full p-2 shadow-lg hover:bg-gray-100 transition-colors z-10"},[...t[28]||(t[28]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),e("img",{src:o(g),alt:"Screenshot",class:"max-w-full max-h-full rounded-lg",onClick:t[14]||(t[14]=T(()=>{},["stop"]))},null,8,Mt)])])):h("",!0)]))]))}});export{Ut as default};
